{
  "exitcode": 1,
  "summary": {
    "passed": 3,
    "failed": 1,
    "total": 4,
    "collected": 4
  },
  "collectors": [
    {
      "nodeid": "",
      "outcome": "passed",
      "result": [
        {
          "nodeid": ".",
          "type": "Dir"
        }
      ]
    },
    {
      "nodeid": "src/fastAPI_aiohttp",
      "outcome": "passed",
      "result": []
    },
    {
      "nodeid": "src/tests/test_fastAPI_aiohttp.py::TestClient",
      "outcome": "passed",
      "result": []
    },
    {
      "nodeid": "src/tests/test_fastAPI_aiohttp.py",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "src/tests/test_fastAPI_aiohttp.py::TestClient",
          "type": "Class"
        },
        {
          "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_query_url",
          "type": "Coroutine",
          "lineno": 24
        },
        {
          "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_endpoint",
          "type": "Function",
          "lineno": 30
        },
        {
          "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_endpoint_multi",
          "type": "Function",
          "lineno": 42
        },
        {
          "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_endpoint_stream",
          "type": "Coroutine",
          "lineno": 55
        }
      ]
    },
    {
      "nodeid": "src/tests",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "src/tests/test_fastAPI_aiohttp.py",
          "type": "Module"
        }
      ]
    },
    {
      "nodeid": "src",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "src/fastAPI_aiohttp",
          "type": "Package"
        },
        {
          "nodeid": "src/tests",
          "type": "Package"
        }
      ]
    },
    {
      "nodeid": ".",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "src",
          "type": "Dir"
        }
      ]
    }
  ],
  "tests": [
    {
      "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_query_url",
      "lineno": 24,
      "outcome": "passed",
      "keywords": [
        "test_query_url",
        "asyncio",
        "pytestmark",
        "test_fastAPI_aiohttp.py",
        "tests",
        "src",
        "raphaelauv@fastapi-aiohttp-example__99c2d449__httpx__aiohttp",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "passed"
      },
      "teardown": {
        "outcome": "passed"
      }
    },
    {
      "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_endpoint",
      "lineno": 30,
      "outcome": "passed",
      "keywords": [
        "test_endpoint",
        "test_fastAPI_aiohttp.py",
        "tests",
        "src",
        "raphaelauv@fastapi-aiohttp-example__99c2d449__httpx__aiohttp",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "passed"
      },
      "teardown": {
        "outcome": "passed"
      }
    },
    {
      "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_endpoint_multi",
      "lineno": 42,
      "outcome": "passed",
      "keywords": [
        "test_endpoint_multi",
        "test_fastAPI_aiohttp.py",
        "tests",
        "src",
        "raphaelauv@fastapi-aiohttp-example__99c2d449__httpx__aiohttp",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "passed"
      },
      "teardown": {
        "outcome": "passed"
      }
    },
    {
      "nodeid": "src/tests/test_fastAPI_aiohttp.py::test_endpoint_stream",
      "lineno": 55,
      "outcome": "failed",
      "keywords": [
        "test_endpoint_stream",
        "asyncio",
        "pytestmark",
        "test_fastAPI_aiohttp.py",
        "tests",
        "src",
        "raphaelauv@fastapi-aiohttp-example__99c2d449__httpx__aiohttp",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "failed",
        "crash": {
          "path": "D:\\repos\\raphaelauv@fastapi-aiohttp-example__99c2d449__httpx__aiohttp\\.venv\\Lib\\site-packages\\aiohttp\\connector.py",
          "lineno": 1130,
          "message": "aiohttp.client_exceptions.ClientConnectorError: Cannot connect to host localhost:8080 ssl:default [The remote computer refused the network connection]"
        },
        "traceback": [
          {
            "path": "src\\tests\\test_fastAPI_aiohttp.py",
            "lineno": 61,
            "message": ""
          },
          {
            "path": ".venv\\Lib\\site-packages\\aiohttp\\client.py",
            "lineno": 1425,
            "message": "in __aenter__"
          },
          {
            "path": ".venv\\Lib\\site-packages\\aiohttp\\client.py",
            "lineno": 703,
            "message": "in _request"
          },
          {
            "path": ".venv\\Lib\\site-packages\\aiohttp\\connector.py",
            "lineno": 548,
            "message": "in connect"
          },
          {
            "path": ".venv\\Lib\\site-packages\\aiohttp\\connector.py",
            "lineno": 1056,
            "message": "in _create_connection"
          },
          {
            "path": ".venv\\Lib\\site-packages\\aiohttp\\connector.py",
            "lineno": 1406,
            "message": "in _create_direct_connection"
          },
          {
            "path": ".venv\\Lib\\site-packages\\aiohttp\\connector.py",
            "lineno": 1375,
            "message": "in _create_direct_connection"
          },
          {
            "path": ".venv\\Lib\\site-packages\\aiohttp\\connector.py",
            "lineno": 1130,
            "message": "ClientConnectorError"
          }
        ],
        "longrepr": "self = <aiohttp.connector.TCPConnector object at 0x0000023BD81DAA80>\naddr_infos = []\nreq = <aiohttp.client_reqrep.ClientRequest object at 0x0000023BD81DAA50>\ntimeout = ClientTimeout(total=300, connect=None, sock_read=None, sock_connect=30, ceil_threshold=5)\nclient_error = <class 'aiohttp.client_exceptions.ClientConnectorError'>\nargs = (functools.partial(<class 'aiohttp.client_proto.ResponseHandler'>, loop=<ProactorEventLoop running=False closed=False debug=False>),)\nkwargs = {'server_hostname': None, 'ssl': None}\n\n    async def _wrap_create_connection(\n        self,\n        *args: Any,\n        addr_infos: List[aiohappyeyeballs.AddrInfoType],\n        req: ClientRequest,\n        timeout: \"ClientTimeout\",\n        client_error: Type[Exception] = ClientConnectorError,\n        **kwargs: Any,\n    ) -> Tuple[asyncio.Transport, ResponseHandler]:\n        try:\n            async with ceil_timeout(\n                timeout.sock_connect, ceil_threshold=timeout.ceil_threshold\n            ):\n>               sock = await aiohappyeyeballs.start_connection(\n                    addr_infos=addr_infos,\n                    local_addr_infos=self._local_addr_infos,\n                    happy_eyeballs_delay=self._happy_eyeballs_delay,\n                    interleave=self._interleave,\n                    loop=self._loop,\n                )\n\n.venv\\Lib\\site-packages\\aiohttp\\connector.py:1115: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n.venv\\Lib\\site-packages\\aiohappyeyeballs\\impl.py:127: in start_connection\n    raise first_exception\n.venv\\Lib\\site-packages\\aiohappyeyeballs\\_staggered.py:132: in run_one_coro\n    result = await coro_fn()\n.venv\\Lib\\site-packages\\aiohappyeyeballs\\impl.py:208: in _connect_sock\n    await loop.sock_connect(sock, address)\nC:\\Users\\Mohay\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\proactor_events.py:729: in sock_connect\n    return await self._proactor.connect(sock, address)\nC:\\Users\\Mohay\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\windows_events.py:803: in _poll\n    value = callback(transferred, key, ov)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ntrans = 0, key = 0, ov = <_overlapped.Overlapped object at 0x0000023BD81BC6F0>\n\n    def finish_connect(trans, key, ov):\n>       ov.getresult()\nE       ConnectionRefusedError: [WinError 1225] The remote computer refused the network connection\n\nC:\\Users\\Mohay\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\windows_events.py:599: ConnectionRefusedError\n\nThe above exception was the direct cause of the following exception:\n\nclient_fastAPI = <starlette.testclient.TestClient object at 0x0000023BD81DA300>\n\n    @pytest.mark.asyncio\n    async def test_endpoint_stream(client_fastAPI):\n        data = b'TOTO' * 10000\n    \n        async with aiohttp.ClientSession() as session:\n>           async with session.post(url='http://localhost:8080/endpoint_stream/', data=data) as result:\n\nsrc\\tests\\test_fastAPI_aiohttp.py:61: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n.venv\\Lib\\site-packages\\aiohttp\\client.py:1425: in __aenter__\n    self._resp: _RetType = await self._coro\n.venv\\Lib\\site-packages\\aiohttp\\client.py:703: in _request\n    conn = await self._connector.connect(\n.venv\\Lib\\site-packages\\aiohttp\\connector.py:548: in connect\n    proto = await self._create_connection(req, traces, timeout)\n.venv\\Lib\\site-packages\\aiohttp\\connector.py:1056: in _create_connection\n    _, proto = await self._create_direct_connection(req, traces, timeout)\n.venv\\Lib\\site-packages\\aiohttp\\connector.py:1406: in _create_direct_connection\n    raise last_exc\n.venv\\Lib\\site-packages\\aiohttp\\connector.py:1375: in _create_direct_connection\n    transp, proto = await self._wrap_create_connection(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <aiohttp.connector.TCPConnector object at 0x0000023BD81DAA80>\naddr_infos = []\nreq = <aiohttp.client_reqrep.ClientRequest object at 0x0000023BD81DAA50>\ntimeout = ClientTimeout(total=300, connect=None, sock_read=None, sock_connect=30, ceil_threshold=5)\nclient_error = <class 'aiohttp.client_exceptions.ClientConnectorError'>\nargs = (functools.partial(<class 'aiohttp.client_proto.ResponseHandler'>, loop=<ProactorEventLoop running=False closed=False debug=False>),)\nkwargs = {'server_hostname': None, 'ssl': None}\n\n    async def _wrap_create_connection(\n        self,\n        *args: Any,\n        addr_infos: List[aiohappyeyeballs.AddrInfoType],\n        req: ClientRequest,\n        timeout: \"ClientTimeout\",\n        client_error: Type[Exception] = ClientConnectorError,\n        **kwargs: Any,\n    ) -> Tuple[asyncio.Transport, ResponseHandler]:\n        try:\n            async with ceil_timeout(\n                timeout.sock_connect, ceil_threshold=timeout.ceil_threshold\n            ):\n                sock = await aiohappyeyeballs.start_connection(\n                    addr_infos=addr_infos,\n                    local_addr_infos=self._local_addr_infos,\n                    happy_eyeballs_delay=self._happy_eyeballs_delay,\n                    interleave=self._interleave,\n                    loop=self._loop,\n                )\n                return await self._loop.create_connection(*args, **kwargs, sock=sock)\n        except cert_errors as exc:\n            raise ClientConnectorCertificateError(req.connection_key, exc) from exc\n        except ssl_errors as exc:\n            raise ClientConnectorSSLError(req.connection_key, exc) from exc\n        except OSError as exc:\n            if exc.errno is None and isinstance(exc, asyncio.TimeoutError):\n                raise\n>           raise client_error(req.connection_key, exc) from exc\nE           aiohttp.client_exceptions.ClientConnectorError: Cannot connect to host localhost:8080 ssl:default [The remote computer refused the network connection]\n\n.venv\\Lib\\site-packages\\aiohttp\\connector.py:1130: ClientConnectorError"
      },
      "teardown": {
        "outcome": "passed"
      }
    }
  ],
  "warnings": [
    {
      "message": "The on_startup and on_shutdown parameters are deprecated, and they will be removed on version 1.0. Use the lifespan parameter instead. See more about it on https://www.starlette.io/lifespan/.",
      "category": "DeprecationWarning",
      "when": "collect",
      "filename": "D:\\repos\\raphaelauv@fastapi-aiohttp-example__99c2d449__httpx__aiohttp\\.venv\\Lib\\site-packages\\starlette\\routing.py",
      "lineno": 599
    }
  ]
}