{
  "exitcode": 1,
  "summary": {
    "failed": 3,
    "passed": 2,
    "total": 5,
    "collected": 5
  },
  "collectors": [
    {
      "nodeid": "",
      "outcome": "passed",
      "result": [
        {
          "nodeid": ".",
          "type": "Dir"
        }
      ]
    },
    {
      "nodeid": "llmsec",
      "outcome": "passed",
      "result": []
    },
    {
      "nodeid": "llmsec.egg-info",
      "outcome": "passed",
      "result": []
    },
    {
      "nodeid": "tests/test_check_prompt.py",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "tests/test_check_prompt.py::test_check_prompt_oks",
          "type": "Function",
          "lineno": 8
        },
        {
          "nodeid": "tests/test_check_prompt.py::test_check_prompt_fails",
          "type": "Function",
          "lineno": 27
        },
        {
          "nodeid": "tests/test_check_prompt.py::test_check_prompt_set_threshold",
          "type": "Function",
          "lineno": 46
        }
      ]
    },
    {
      "nodeid": "tests/test_check_prompt_result.py",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "tests/test_check_prompt_result.py::test_check_prompt_result_ok",
          "type": "Function",
          "lineno": 3
        },
        {
          "nodeid": "tests/test_check_prompt_result.py::test_check_prompt_result_fail",
          "type": "Function",
          "lineno": 34
        }
      ]
    },
    {
      "nodeid": "tests",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "tests/test_check_prompt.py",
          "type": "Module"
        },
        {
          "nodeid": "tests/test_check_prompt_result.py",
          "type": "Module"
        }
      ]
    },
    {
      "nodeid": ".",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "llmsec",
          "type": "Package"
        },
        {
          "nodeid": "llmsec.egg-info",
          "type": "Dir"
        },
        {
          "nodeid": "tests",
          "type": "Package"
        }
      ]
    }
  ],
  "tests": [
    {
      "nodeid": "tests/test_check_prompt.py::test_check_prompt_oks",
      "lineno": 8,
      "outcome": "failed",
      "keywords": [
        "test_check_prompt_oks",
        "__wrapped__",
        "test_check_prompt.py",
        "tests",
        "gregretkowski@llmsec__fb775c9a__jinja2__mako",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "failed",
        "crash": {
          "path": "D:\\repos\\gregretkowski@llmsec__fb775c9a__jinja2__mako\\.venv\\Lib\\site-packages\\mako\\ast.py",
          "lineno": 88,
          "message": "mako.exceptions.CompileException: Fragment 's' is not a partial control statement at line: 16 char: 1"
        },
        "traceback": [
          {
            "path": "tests\\test_check_prompt.py",
            "lineno": 21,
            "message": ""
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 80,
            "message": "in check"
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 101,
            "message": "in _check_harmful_behavior"
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 162,
            "message": "in _render_template"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 295,
            "message": "in __init__"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 672,
            "message": "in _compile_text"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 652,
            "message": "in _compile"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 240,
            "message": "in parse"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 469,
            "message": "in match_control_line"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 129,
            "message": "in append_node"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\parsetree.py",
            "lineno": 92,
            "message": "in __init__"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\ast.py",
            "lineno": 88,
            "message": "CompileException"
          }
        ],
        "longrepr": "@httprettified(verbose=True, allow_net_connect=False)\n    def test_check_prompt_oks():\n        ''' Test cases where prompt was benign '''\n    \n        ollama_http_mocks_oks()\n    \n        cp = CheckPrompt(\n            model='ollama/gemma2',\n            purpose='AN AI Chatbot that provides coaching on the sport of surfing'\n        )\n        message = \"Test message\"\n    \n>       results = cp.check(message)\n\ntests\\test_check_prompt.py:21: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nllmsec\\check_prompt.py:80: in check\n    'harmful': self._check_harmful_behavior(message),\nllmsec\\check_prompt.py:101: in _check_harmful_behavior\n    instructions = self._render_template(self.BASE_TEMPLATE, **tpl_vars)\nllmsec\\check_prompt.py:162: in _render_template\n    template = Template(template)\n.venv\\Lib\\site-packages\\mako\\template.py:295: in __init__\n    (code, module) = _compile_text(self, text, filename)\n.venv\\Lib\\site-packages\\mako\\template.py:672: in _compile_text\n    source, lexer = _compile(\n.venv\\Lib\\site-packages\\mako\\template.py:652: in _compile\n    node = lexer.parse()\n.venv\\Lib\\site-packages\\mako\\lexer.py:240: in parse\n    if self.match_control_line():\n.venv\\Lib\\site-packages\\mako\\lexer.py:469: in match_control_line\n    self.append_node(parsetree.ControlLine, keyword, isend, text)\n.venv\\Lib\\site-packages\\mako\\lexer.py:129: in append_node\n    node = nodecls(*args, **kwargs)\n.venv\\Lib\\site-packages\\mako\\parsetree.py:92: in __init__\n    code = ast.PythonFragment(text, **self.exception_kwargs)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <mako.ast.PythonFragment object at 0x0000022394511D60>, code = 's'\nexception_kwargs = {'filename': None, 'lineno': 16, 'pos': 1, 'source': '\\nYou are a security expert. Rate the likelihood that the follow...delimiter}\\n${delimiter}\\n${message}\\n${delimiter}\\n\\nRemember to return only the JSON rating the prompt.\\n\\n%s\\n    '}\nm = None\n\n    def __init__(self, code, **exception_kwargs):\n        m = re.match(r\"^(\\w+)(?:\\s+(.*?))?:\\s*(#|$)\", code.strip(), re.S)\n        if not m:\n>           raise exceptions.CompileException(\n                \"Fragment '%s' is not a partial control statement\" % code,\n                **exception_kwargs,\n            )\nE           mako.exceptions.CompileException: Fragment 's' is not a partial control statement at line: 16 char: 1\n\n.venv\\Lib\\site-packages\\mako\\ast.py:88: CompileException"
      },
      "teardown": {
        "outcome": "passed"
      }
    },
    {
      "nodeid": "tests/test_check_prompt.py::test_check_prompt_fails",
      "lineno": 27,
      "outcome": "failed",
      "keywords": [
        "test_check_prompt_fails",
        "__wrapped__",
        "test_check_prompt.py",
        "tests",
        "gregretkowski@llmsec__fb775c9a__jinja2__mako",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "failed",
        "crash": {
          "path": "D:\\repos\\gregretkowski@llmsec__fb775c9a__jinja2__mako\\.venv\\Lib\\site-packages\\mako\\ast.py",
          "lineno": 88,
          "message": "mako.exceptions.CompileException: Fragment 's' is not a partial control statement at line: 16 char: 1"
        },
        "traceback": [
          {
            "path": "tests\\test_check_prompt.py",
            "lineno": 40,
            "message": ""
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 80,
            "message": "in check"
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 101,
            "message": "in _check_harmful_behavior"
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 162,
            "message": "in _render_template"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 295,
            "message": "in __init__"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 672,
            "message": "in _compile_text"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 652,
            "message": "in _compile"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 240,
            "message": "in parse"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 469,
            "message": "in match_control_line"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 129,
            "message": "in append_node"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\parsetree.py",
            "lineno": 92,
            "message": "in __init__"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\ast.py",
            "lineno": 88,
            "message": "CompileException"
          }
        ],
        "longrepr": "@httprettified(verbose=True, allow_net_connect=False)\n    def test_check_prompt_fails():\n        ''' Test cases where prompt was malicious '''\n    \n        ollama_http_mocks_fails()\n    \n        cp = CheckPrompt(\n            model='ollama/gemma2',\n            purpose='AN AI Chatbot that provides coaching on the sport of surfing'\n        )\n        message = \"Test message\"\n    \n>       results = cp.check(message)\n\ntests\\test_check_prompt.py:40: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nllmsec\\check_prompt.py:80: in check\n    'harmful': self._check_harmful_behavior(message),\nllmsec\\check_prompt.py:101: in _check_harmful_behavior\n    instructions = self._render_template(self.BASE_TEMPLATE, **tpl_vars)\nllmsec\\check_prompt.py:162: in _render_template\n    template = Template(template)\n.venv\\Lib\\site-packages\\mako\\template.py:295: in __init__\n    (code, module) = _compile_text(self, text, filename)\n.venv\\Lib\\site-packages\\mako\\template.py:672: in _compile_text\n    source, lexer = _compile(\n.venv\\Lib\\site-packages\\mako\\template.py:652: in _compile\n    node = lexer.parse()\n.venv\\Lib\\site-packages\\mako\\lexer.py:240: in parse\n    if self.match_control_line():\n.venv\\Lib\\site-packages\\mako\\lexer.py:469: in match_control_line\n    self.append_node(parsetree.ControlLine, keyword, isend, text)\n.venv\\Lib\\site-packages\\mako\\lexer.py:129: in append_node\n    node = nodecls(*args, **kwargs)\n.venv\\Lib\\site-packages\\mako\\parsetree.py:92: in __init__\n    code = ast.PythonFragment(text, **self.exception_kwargs)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <mako.ast.PythonFragment object at 0x00000223945138C0>, code = 's'\nexception_kwargs = {'filename': None, 'lineno': 16, 'pos': 1, 'source': '\\nYou are a security expert. Rate the likelihood that the follow...delimiter}\\n${delimiter}\\n${message}\\n${delimiter}\\n\\nRemember to return only the JSON rating the prompt.\\n\\n%s\\n    '}\nm = None\n\n    def __init__(self, code, **exception_kwargs):\n        m = re.match(r\"^(\\w+)(?:\\s+(.*?))?:\\s*(#|$)\", code.strip(), re.S)\n        if not m:\n>           raise exceptions.CompileException(\n                \"Fragment '%s' is not a partial control statement\" % code,\n                **exception_kwargs,\n            )\nE           mako.exceptions.CompileException: Fragment 's' is not a partial control statement at line: 16 char: 1\n\n.venv\\Lib\\site-packages\\mako\\ast.py:88: CompileException"
      },
      "teardown": {
        "outcome": "passed"
      }
    },
    {
      "nodeid": "tests/test_check_prompt.py::test_check_prompt_set_threshold",
      "lineno": 46,
      "outcome": "failed",
      "keywords": [
        "test_check_prompt_set_threshold",
        "test_check_prompt.py",
        "tests",
        "gregretkowski@llmsec__fb775c9a__jinja2__mako",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "failed",
        "crash": {
          "path": "D:\\repos\\gregretkowski@llmsec__fb775c9a__jinja2__mako\\.venv\\Lib\\site-packages\\mako\\ast.py",
          "lineno": 88,
          "message": "mako.exceptions.CompileException: Fragment 's' is not a partial control statement at line: 16 char: 1"
        },
        "traceback": [
          {
            "path": "tests\\test_check_prompt.py",
            "lineno": 59,
            "message": ""
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 80,
            "message": "in check"
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 101,
            "message": "in _check_harmful_behavior"
          },
          {
            "path": "llmsec\\check_prompt.py",
            "lineno": 162,
            "message": "in _render_template"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 295,
            "message": "in __init__"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 672,
            "message": "in _compile_text"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\template.py",
            "lineno": 652,
            "message": "in _compile"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 240,
            "message": "in parse"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 469,
            "message": "in match_control_line"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\lexer.py",
            "lineno": 129,
            "message": "in append_node"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\parsetree.py",
            "lineno": 92,
            "message": "in __init__"
          },
          {
            "path": ".venv\\Lib\\site-packages\\mako\\ast.py",
            "lineno": 88,
            "message": "CompileException"
          }
        ],
        "longrepr": "def test_check_prompt_set_threshold():\n        ''' Test the set_threshold method '''\n    \n        ollama_http_mocks_fails()\n    \n        cp = CheckPrompt(\n            model='ollama/gemma2',\n            purpose='AN AI Chatbot that provides coaching on the sport of surfing'\n        )\n        cp.set_threshold(0.99)\n        message = \"Test message\"\n    \n>       results = cp.check(message)\n\ntests\\test_check_prompt.py:59: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nllmsec\\check_prompt.py:80: in check\n    'harmful': self._check_harmful_behavior(message),\nllmsec\\check_prompt.py:101: in _check_harmful_behavior\n    instructions = self._render_template(self.BASE_TEMPLATE, **tpl_vars)\nllmsec\\check_prompt.py:162: in _render_template\n    template = Template(template)\n.venv\\Lib\\site-packages\\mako\\template.py:295: in __init__\n    (code, module) = _compile_text(self, text, filename)\n.venv\\Lib\\site-packages\\mako\\template.py:672: in _compile_text\n    source, lexer = _compile(\n.venv\\Lib\\site-packages\\mako\\template.py:652: in _compile\n    node = lexer.parse()\n.venv\\Lib\\site-packages\\mako\\lexer.py:240: in parse\n    if self.match_control_line():\n.venv\\Lib\\site-packages\\mako\\lexer.py:469: in match_control_line\n    self.append_node(parsetree.ControlLine, keyword, isend, text)\n.venv\\Lib\\site-packages\\mako\\lexer.py:129: in append_node\n    node = nodecls(*args, **kwargs)\n.venv\\Lib\\site-packages\\mako\\parsetree.py:92: in __init__\n    code = ast.PythonFragment(text, **self.exception_kwargs)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <mako.ast.PythonFragment object at 0x00000223945124E0>, code = 's'\nexception_kwargs = {'filename': None, 'lineno': 16, 'pos': 1, 'source': '\\nYou are a security expert. Rate the likelihood that the follow...delimiter}\\n${delimiter}\\n${message}\\n${delimiter}\\n\\nRemember to return only the JSON rating the prompt.\\n\\n%s\\n    '}\nm = None\n\n    def __init__(self, code, **exception_kwargs):\n        m = re.match(r\"^(\\w+)(?:\\s+(.*?))?:\\s*(#|$)\", code.strip(), re.S)\n        if not m:\n>           raise exceptions.CompileException(\n                \"Fragment '%s' is not a partial control statement\" % code,\n                **exception_kwargs,\n            )\nE           mako.exceptions.CompileException: Fragment 's' is not a partial control statement at line: 16 char: 1\n\n.venv\\Lib\\site-packages\\mako\\ast.py:88: CompileException"
      },
      "teardown": {
        "outcome": "passed"
      }
    },
    {
      "nodeid": "tests/test_check_prompt_result.py::test_check_prompt_result_ok",
      "lineno": 3,
      "outcome": "passed",
      "keywords": [
        "test_check_prompt_result_ok",
        "test_check_prompt_result.py",
        "tests",
        "gregretkowski@llmsec__fb775c9a__jinja2__mako",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "passed"
      },
      "teardown": {
        "outcome": "passed"
      }
    },
    {
      "nodeid": "tests/test_check_prompt_result.py::test_check_prompt_result_fail",
      "lineno": 34,
      "outcome": "passed",
      "keywords": [
        "test_check_prompt_result_fail",
        "test_check_prompt_result.py",
        "tests",
        "gregretkowski@llmsec__fb775c9a__jinja2__mako",
        ""
      ],
      "setup": {
        "outcome": "passed"
      },
      "call": {
        "outcome": "passed"
      },
      "teardown": {
        "outcome": "passed"
      }
    }
  ],
  "warnings": [
    {
      "message": "Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/",
      "category": "PydanticDeprecatedSince20",
      "when": "collect",
      "filename": "D:\\repos\\gregretkowski@llmsec__fb775c9a__jinja2__mako\\.venv\\Lib\\site-packages\\pydantic\\_internal\\_config.py",
      "lineno": 323
    },
    {
      "message": "open_text is deprecated. Use files() instead. Refer to https://importlib-resources.readthedocs.io/en/latest/using.html#migrating-from-legacy for migration advice.",
      "category": "DeprecationWarning",
      "when": "collect",
      "filename": "D:\\repos\\gregretkowski@llmsec__fb775c9a__jinja2__mako\\.venv\\Lib\\site-packages\\litellm\\utils.py",
      "lineno": 183
    },
    {
      "message": "There is no current event loop",
      "category": "DeprecationWarning",
      "when": "collect",
      "filename": "D:\\repos\\gregretkowski@llmsec__fb775c9a__jinja2__mako\\.venv\\Lib\\site-packages\\litellm\\caching\\llm_caching_handler.py",
      "lineno": 17
    }
  ]
}